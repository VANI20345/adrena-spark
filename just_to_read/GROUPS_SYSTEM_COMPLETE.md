# ูุธุงู ุงููุฌููุนุงุช - ููุชูู ุจุงููุงูู โ

## ุงูุชุญุฏูุซ ุงูุฃุฎูุฑ: 2025-10-04

---

## ๐ฏ ุงูุชุญุณููุงุช ุงููููุฐุฉ

### 1. โ ุตูุญุฉ ูููุตูุฉ ูููุฌููุนุฉ
**ุงููุดููุฉ**: ุงูุดุงุช ูุงู ููุชุญ ูู ูุต ุงูุตูุญุฉ ุจุฏูู ุชูุธูู

**ุงูุญู**: 
- ุฅูุดุงุก ุตูุญุฉ ุฌุฏูุฏุฉ `/groups/:groupId` ูู `src/pages/GroupDetails.tsx`
- ุงูุตูุญุฉ ุชุญุชูู ุนูู:
  - ุงุณู ุงููุฌููุนุฉ ูููุนูุง
  - ูุงุฆูุฉ ุงูุฃุนุถุงุก ูุน ุฃุฏูุงุฑูู (ูุงููุ ูุดุฑูุ ุนุถู)
  - ุฎูุงุฑ ูุบุงุฏุฑุฉ ุงููุฌููุนุฉ
  - ุฎูุงุฑ ูุชู/ุฅูุบุงุก ูุชู ุงูุฅุดุนุงุฑุงุช
  - ูุธุงู ุฏุฑุฏุดุฉ ูุงูู

### 2. โ ุชุญุณูู ูุงุฌูุฉ ูุงุฆูุฉ ุงููุฌููุนุงุช
**ุงููุดููุฉ**: ูุง ููุฌุฏ ูุฑู ุจูู ุฒุฑ "ุงูุถู" ู"ุนุฑุถ ุงููุฌููุนุฉ"

**ุงูุญู**:
- ุฅุถุงูุฉ ูุญุต ุนุถููุฉ ุงููุณุชุฎุฏู `isUserMember()`
- ุฅุฐุง ูุงู ุนุถู: ูุธูุฑ ุฒุฑ "ุนุฑุถ ุงููุฌููุนุฉ"
- ุฅุฐุง ูู ููู ุนุถู: ูุธูุฑ ุฒุฑ "ุงูุถู"
- ุนูุฏ ุงูุงูุถูุงูุ ููุชูู ุชููุงุฆูุงู ูุตูุญุฉ ุงููุฌููุนุฉ

### 3. โ ุฅุตูุงุญ ูุธุงู ุงูุฑุณุงุฆู
**ุงููุดููุฉ**: ุงูุฑุณุงุฆู ูุง ุชุตู ููุฃุนุถุงุก ุงูุขุฎุฑูู

**ุงูุญู**:
- ุชุญุฏูุซ `useGroupMessages.ts` ูุนุฏู ุงุณุชุฎุฏุงู foreign key join ูุน profiles
- ุฌูุจ ุจูุงูุงุช ุงููุณุชุฎุฏููู ุจุดูู ูููุตู
- ุงูุชุฃูุฏ ูู ุณูุงุณุงุช RLS ููุณูุงุญ ุจุงููุชุงุจุฉ ููุฃุนุถุงุก ููุท

---

## ๐ ุงููููุงุช ุงูุฌุฏูุฏุฉ

### 1. `src/pages/GroupDetails.tsx`
ุตูุญุฉ ุชูุงุตูู ุงููุฌููุนุฉ ุงููุงููุฉ ุชุญุชูู ุนูู:
```typescript
- ูุนูููุงุช ุงููุฌููุนุฉ (ุงูุงุณูุ ุงูููุนุ ุนุฏุฏ ุงูุฃุนุถุงุก)
- ูุงุฆูุฉ ุงูุฃุนุถุงุก ูุน ุงูุฃููููุงุช ูุงูุฃุฏูุงุฑ
- ุฎูุงุฑ ุงููุบุงุฏุฑุฉ (ุฅูุง ูููุงูู)
- ุฎูุงุฑ ูุชู ุงูุฅุดุนุงุฑุงุช
- ูุธุงู ุงูุฏุฑุฏุดุฉ
- ุฒุฑ ุงูุนูุฏุฉ ูููุฌููุนุงุช
```

---

## ๐ ุงูุชุญุฏูุซุงุช ุนูู ุงููููุงุช ุงูููุฌูุฏุฉ

### 1. `src/pages/Groups.tsx`
**ุงูุชุบููุฑุงุช**:
- ุฅุฒุงูุฉ `selectedGroup` ู `chatMessages` states
- ุฅุถุงูุฉ `userMemberships` state ูุชุชุจุน ุนุถููุฉ ุงููุณุชุฎุฏู
- ุชุญุฏูุซ `handleJoinGroup` ููุงูุชูุงู ูุตูุญุฉ ุงูุชูุงุตูู ุจุนุฏ ุงูุงูุถูุงู
- ุฅุถุงูุฉ `isUserMember()` ููุชุญูู ูู ุงูุนุถููุฉ
- ุชุญุฏูุซ ุงูุฃุฒุฑุงุฑ ูุนุฑุถ "ุนุฑุถ ุงููุฌููุนุฉ" ุฃู "ุงูุถู" ุญุณุจ ุงูุญุงูุฉ
- ุฅุฒุงูุฉ ุงูุดุงุช ุงููุฏูุฌ ูู ุงูุตูุญุฉ

### 2. `src/App.tsx`
**ุงูุชุบููุฑุงุช**:
- ุฅุถุงูุฉ import ูู `GroupDetails`
- ุฅุถุงูุฉ route ุฌุฏูุฏ: `/groups/:groupId`

### 3. `src/hooks/useGroupMessages.ts`
**ุงูุชุบููุฑุงุช**:
- ุฅุฒุงูุฉ foreign key join ูุน profiles ูู query
- ุฌูุจ ุฃุณูุงุก ุงููุณุชุฎุฏููู ุจุงุณุชุฎุฏุงู `Promise.all` ุจุดูู ูููุตู
- ุชุญุณูู error handling

---

## ๐จ ูููุฒุงุช ูุงุฌูุฉ ุงููุณุชุฎุฏู

### ุตูุญุฉ GroupDetails
1. **Header**:
   - ุฒุฑ ุงูุนูุฏุฉ ูููุฌููุนุงุช
   - ุนุฑุถ ูุงุถุญ ููุชููู

2. **ูุนูููุงุช ุงููุฌููุนุฉ** (ุงูุฌุงูุจ ุงูุฃูุณุฑ):
   - ุงุณู ุงููุฌููุนุฉ
   - ููุน ุงููุฌููุนุฉ (ููุทูุฉ/ูุนุงููุฉ)
   - ุนุฏุฏ ุงูุฃุนุถุงุก ุงูุญุงูู/ุงูุฃูุตู
   - ุฒุฑ ูุชู/ุฅูุบุงุก ูุชู ุงูุฅุดุนุงุฑุงุช
   - ุฒุฑ ูุบุงุฏุฑุฉ ุงููุฌููุนุฉ (ูุฎูู ูููุงูู)

3. **ูุงุฆูุฉ ุงูุฃุนุถุงุก**:
   - ุนุฑุถ ุฌููุน ุงูุฃุนุถุงุก ูุน ุตูุฑูู ุงูุฑูุฒูุฉ
   - ุฃููููุงุช ุงูุฃุฏูุงุฑ:
     - ๐ ุชุงุฌ ุฐูุจู ูููุงูู
     - ๐ก๏ธ ุฏุฑุน ุฃุฒุฑู ูููุดุฑู
   - Badges ููุฃุฏูุงุฑ
   - ูุงุจูุฉ ููุชูุฑูุฑ

4. **ุงูุฏุฑุฏุดุฉ** (ุงูุฌุงูุจ ุงูุฃููู):
   - ูุธุงู ุฏุฑุฏุดุฉ ูุงูู
   - ุนุฑุถ ุงูุฑุณุงุฆู ูู ุงูููุช ุงููุนูู
   - ุฅุฑุณุงู ุงูุฑุณุงุฆู

### ุตูุญุฉ Groups ุงููุญุฏุซุฉ
1. **ูุงุฆูุฉ ุงููุฌููุนุงุช**:
   - ุฒุฑ ุฐูู ูุชุบูุฑ ุญุณุจ ุญุงูุฉ ุงูุนุถููุฉ
   - ุฅุฐุง ุนุถู: "ุนุฑุถ ุงููุฌููุนุฉ"
   - ุฅุฐุง ุบูุฑ ุนุถู: "ุงูุถู"
   - ุชุนุทูู ุฒุฑ ุงูุงูุถูุงู ูููุฌููุนุงุช ุงูููุชูุฆุฉ

---

## ๐ ุณูุงุณุงุช ุงูุฃูุงู (RLS)

### ุฌุฏูู `group_members`
```sql
-- ุงูุณูุงุญ ุจุงูุงูุถูุงู
CREATE POLICY "Users can join any group"
ON group_members FOR INSERT TO authenticated
WITH CHECK (auth.uid() = user_id);

-- ุนุฑุถ ุงูุฃุนุถุงุก
CREATE POLICY "Everyone can view group members"
ON group_members FOR SELECT TO authenticated
USING (true);

-- ุงููุบุงุฏุฑุฉ
CREATE POLICY "Users can leave groups"
ON group_members FOR DELETE TO authenticated
USING (auth.uid() = user_id);

-- ุญุฐู ุงูุฃุนุถุงุก (ูููุดุฑููู ูุงูุฃุฏูู)
CREATE POLICY "Organizers and admins can remove members"
ON group_members FOR DELETE TO authenticated
USING (
  EXISTS (
    SELECT 1 FROM event_groups eg
    WHERE eg.id = group_members.group_id 
    AND (eg.created_by = auth.uid() OR 
         EXISTS (SELECT 1 FROM user_roles WHERE user_id = auth.uid() AND role = 'admin'))
  )
);
```

### ุฌุฏูู `group_messages`
```sql
-- ุฅุฑุณุงู ุงูุฑุณุงุฆู (ููุฃุนุถุงุก ููุท)
CREATE POLICY "Group members can create messages"
ON group_messages FOR INSERT TO authenticated
WITH CHECK (
  auth.uid() = sender_id AND
  EXISTS (
    SELECT 1 FROM group_members gm
    WHERE gm.group_id = group_messages.group_id 
    AND gm.user_id = auth.uid()
  )
);

-- ุนุฑุถ ุงูุฑุณุงุฆู (ููุฃุนุถุงุก ููุท)
CREATE POLICY "Group members can view messages"
ON group_messages FOR SELECT TO authenticated
USING (
  EXISTS (
    SELECT 1 FROM group_members gm
    WHERE gm.group_id = group_messages.group_id 
    AND gm.user_id = auth.uid()
  )
);
```

---

## โ ุงุฎุชุจุงุฑุงุช ูุทููุจุฉ

### 1. ุงุฎุชุจุงุฑ ุงูุงูุถูุงู
- [x] ุงูุถุบุท ุนูู "ุงูุถู" ูู ูุงุฆูุฉ ุงููุฌููุนุงุช
- [x] ุงูุชุฃูุฏ ูู ุงูุงูุชูุงู ูุตูุญุฉ ุงูุชูุงุตูู
- [x] ุงูุชุญูู ูู ุธููุฑ ุงููุณุชุฎุฏู ูู ูุงุฆูุฉ ุงูุฃุนุถุงุก
- [x] ุงูุชุฃูุฏ ูู ุชุญูู ุงูุฒุฑ ุฅูู "ุนุฑุถ ุงููุฌููุนุฉ"

### 2. ุงุฎุชุจุงุฑ ุงูุฏุฑุฏุดุฉ
- [ ] ุฅุฑุณุงู ุฑุณุงูุฉ ูู ุงููุฌููุนุฉ
- [ ] ุงูุชุญูู ูู ุธููุฑ ุงูุฑุณุงูุฉ
- [ ] ูุชุญ ูุงูุฐุฉ ุฃุฎุฑู ุจูุณุชุฎุฏู ุขุฎุฑ
- [ ] ุงูุชุญูู ูู ูุตูู ุงูุฑุณุงูุฉ ูููุณุชุฎุฏู ุงูุขุฎุฑ

### 3. ุงุฎุชุจุงุฑ ุงููุบุงุฏุฑุฉ
- [ ] ุงูุถุบุท ุนูู "ูุบุงุฏุฑุฉ ุงููุฌููุนุฉ"
- [ ] ุงูุชุญูู ูู ุงูุนูุฏุฉ ูุตูุญุฉ ุงููุฌููุนุงุช
- [ ] ุงูุชุญูู ูู ุงุฎุชูุงุก ุงููุณุชุฎุฏู ูู ูุงุฆูุฉ ุงูุฃุนุถุงุก
- [ ] ุงูุชุญูู ูู ุชุญูู ุงูุฒุฑ ุฅูู "ุงูุถู" ูุฌุฏุฏุงู

### 4. ุงุฎุชุจุงุฑ ูุชู ุงูุฅุดุนุงุฑุงุช
- [ ] ุงูุถุบุท ุนูู "ูุชู ุงูุฅุดุนุงุฑุงุช"
- [ ] ุงูุชุญูู ูู ุชุญูู ุงูุฒุฑ ุฅูู "ุฅูุบุงุก ูุชู ุงูุฅุดุนุงุฑุงุช"
- [ ] ุงูุชุญูู ูู ุญูุธ ุงูุญุงูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 5. ุงุฎุชุจุงุฑ ุงูุฃุฏูุงุฑ
- [ ] ุงูุชุญูู ูู ุธููุฑ ุชุงุฌ ูููุงูู
- [ ] ุงูุชุญูู ูู ุธููุฑ ุฏุฑุน ูููุดุฑู
- [ ] ุงูุชุญูู ูู ุฅุฎูุงุก ุฒุฑ ุงููุบุงุฏุฑุฉ ูููุงูู

---

## ๐ง ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ

### 1. ุงูุฅุดุนุงุฑุงุช
- ุฅุดุนุงุฑ ุนูุฏ ูุตูู ุฑุณุงูุฉ ุฌุฏูุฏุฉ
- ุฅุดุนุงุฑ ุนูุฏ ุฅุถุงูุฉ ุนุถู ุฌุฏูุฏ
- ุฏุนู ุงูุฅุดุนุงุฑุงุช ุญุชู ูุน ูุชู ุงููุฌููุนุฉ

### 2. ุงููุณุงุฆุท
- ุฅุฑุณุงู ุงูุตูุฑ ูู ุงูุฏุฑุฏุดุฉ
- ุฅุฑุณุงู ุงููููุงุช
- ูุนุงููุฉ ุงูุฑูุงุจุท

### 3. ุงูุจุญุซ
- ุงูุจุญุซ ูู ุงูุฑุณุงุฆู
- ููุชุฑุฉ ุงูุฃุนุถุงุก

### 4. ุงูุฅุญุตุงุฆูุงุช
- ุนุฏุฏ ุงูุฑุณุงุฆู ููู ุนุถู
- ุฃูุดุท ุงูุฃุนุถุงุก
- ุฅุญุตุงุฆูุงุช ุงููุฌููุนุฉ

---

## ๐ ุงูุญุงูุฉ ุงูุญุงููุฉ

| ุงูููุฒุฉ | ุงูุญุงูุฉ |
|--------|---------|
| ุฅูุดุงุก ุงููุฌููุนุงุช | โ ูุนูู |
| ุงูุงูุถูุงู ูููุฌููุนุงุช | โ ูุนูู |
| ุตูุญุฉ ุชูุงุตูู ุงููุฌููุนุฉ | โ ุฌุฏูุฏ |
| ูุงุฆูุฉ ุงูุฃุนุถุงุก | โ ุฌุฏูุฏ |
| ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช | โ ุฌุฏูุฏ |
| ุงูุฏุฑุฏุดุฉ | โ ูุนูู |
| ุงูุฑุณุงุฆู ุงูููุฑูุฉ | โ๏ธ ูุญุชุงุฌ ุงุฎุชุจุงุฑ |
| ุงููุบุงุฏุฑุฉ | โ ุฌุฏูุฏ |
| ูุชู ุงูุฅุดุนุงุฑุงุช | โ ุฌุฏูุฏ |
| ุงูุฃูุงู (RLS) | โ ูุญุฏูุซ |

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ูููุณุชุฎุฏููู:
1. ุงุฐูุจ ุฅูู ุตูุญุฉ ุงููุฌููุนุงุช `/groups`
2. ุงุฎุชุฑ ูุฌููุนุฉ ูุงุถุบุท "ุงูุถู"
3. ุณุชูุชูู ุชููุงุฆูุงู ูุตูุญุฉ ุงููุฌููุนุฉ
4. ููููู:
   - ุฅุฑุณุงู ุฑุณุงุฆู
   - ุฑุคูุฉ ุงูุฃุนุถุงุก
   - ูุชู ุงูุฅุดุนุงุฑุงุช
   - ูุบุงุฏุฑุฉ ุงููุฌููุนุฉ

### ููููุธููู:
1. ุฃูุดุฆ ูุนุงููุฉ ุฌุฏูุฏุฉ
2. ุงููุฌููุนุฉ ุชููุดุฃ ุชููุงุฆูุงู
3. ุฃูุช ุงููุงูู ุชููุงุฆูุงู
4. ููููู ุฅุฏุงุฑุฉ ุงูุฃุนุถุงุก

---

**ุขุฎุฑ ุชุญุฏูุซ**: 2025-10-04
**ุงูุญุงูุฉ**: โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู - ูุญุชุงุฌ ุงุฎุชุจุงุฑ ุงูุฑุณุงุฆู ุงูููุฑูุฉ
