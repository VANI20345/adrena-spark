# ุญุงูุฉ ุชุทุจูู ูุธุงู ุงููุฌููุนุงุช ุงูุดุงูู

## โ ุงูุฃุฌุฒุงุก ุงูููุชููุฉ

### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุฅุถุงูุฉ ุญููู ุฌุฏูุฏุฉ ูุฌุฏูู `event_groups`:
  - `archived_at` - ุชุงุฑูุฎ ุงูุฃุฑุดูุฉ
  - `auto_delete_at` - ุชุงุฑูุฎ ุงูุญุฐู ุงูุชููุงุฆู
  - `assigned_admin_id` - ุงูุฃุฏูู ุงููุนูู ูููุฌููุนุฉ
  
- โ ุฅูุดุงุก ุฌุฏูู `admin_group_assignments` ูู Load Balancing
  - ุชุชุจุน ุนุฏุฏ ุงููุฌููุนุงุช ููู ุฃุฏูู
  - ุงุฎุชูุงุฑ ุฃุฏูู ุจุฃูู ุนุฏุฏ ูุฌููุนุงุช ุชููุงุฆูุงู

- โ ุชุญุฏูุซ ุฃุฏูุงุฑ ุฃุนุถุงุก ุงููุฌููุนุฉ
  - owner, moderator, admin, member

### 2. Triggers ุงูุชููุงุฆูุฉ
- โ `setup_group_moderators()` - ุชุนููู ุงููุดุฑููู ุนูุฏ ุฅูุดุงุก ุงููุฌููุนุฉ:
  - ุชุนููู ุตุงุญุจ ุงููุฌููุนุฉ ูู owner
  - ุชุนููู ุฃุฏูู ููุดุฑู ุซุงูู (load balancing)
  
- โ `decrease_admin_group_count()` - ุชูููู ุนุฏุงุฏ ุงููุฌููุนุงุช ุนูุฏ ุงูุญุฐู

- โ `calculate_auto_delete_date()` - ุญุณุงุจ ููุนุฏ ุงูุญุฐู ุงูุชููุงุฆู:
  - ุชุงุฑูุฎ ุงูุชูุงุก ุงููุนุงููุฉ + 7 ุฃูุงู ููุฃุฑุดูุฉ
  - 30 ููู ุจุนุฏ ุงูุฃุฑุดูุฉ ููุญุฐู ุงูููุงุฆู

### 3. Edge Functions
- โ `archive-expired-groups` - ูุธููุฉ ุงูุฃุฑุดูุฉ ูุงูุญุฐู ุงูุชููุงุฆู:
  - ุฃุฑุดูุฉ ุงููุฌููุนุงุช ุงูููุชููุฉ
  - ุญุฐู ุงููุฌููุนุงุช ุงููุคุฑุดูุฉ ุจุนุฏ 30 ููู
  - ุชูููู ุนุฏุงุฏ ุงูุฃุฏูู ุชููุงุฆูุงู

### 4. ูุงุฌูุฉ ุงูุฃุฏูู
- โ ุชุงุจ "ุฅุฏุงุฑุฉ ุงููุฌููุนุงุช" ูู ููุญุฉ ุงูุฃุฏูู:
  - ุนุฑุถ ูุฌููุนุงุช ุงููุนุงููุงุช
  - ุนุฑุถ ุงููุฌููุนุงุช ุงูุฅูููููุฉ
  - ุนุฑุถ ุฃุนุถุงุก ูู ูุฌููุนุฉ
  - ูุชู/ุฅูุบุงุก ูุชู ุงูุฃุนุถุงุก
  - ุฅุฒุงูุฉ ุงูุฃุนุถุงุก (ุนุฏุง ุงูู owner ู admin)
  - ุฃุฑุดูุฉ ุงููุฌููุนุงุช ูุฏููุงู
  - ุญุฐู ุงููุฌููุนุงุช ููุงุฆูุงู

### 5. ุชุญุฏูุซุงุช ุงูููุฏ
- โ ุชุญุฏูุซ `CreateGroupDialog` ูุฏุนู ุงูุชุนููู ุงูุชููุงุฆู ูููุดุฑููู
- โ ุญูุงูุฉ ุงูู owner ูุงูู admin ูู ุงูุฅุฒุงูุฉ

## โ๏ธ ูุญุชุงุฌ ุฅูู ุชูููุฐ

### 1. Cron Job ููุชุดุบูู ุงูุชููุงุฆู
**ุงูุญุงูุฉ**: ูุญุชุงุฌ ุฅูู ุฅุนุฏุงุฏ ูุฏูู ูู Supabase Dashboard

**ุงูุฎุทูุงุช ุงููุทููุจุฉ**:
1. ุงูุฐูุงุจ ุฅูู SQL Editor ูู Supabase
2. ุชูุนูู ุงูุฅุถุงูุงุช:
```sql
CREATE EXTENSION IF NOT EXISTS pg_cron;
CREATE EXTENSION IF NOT EXISTS pg_net;
```

3. ุฅูุดุงุก Cron Job:
```sql
SELECT cron.schedule(
  'archive-expired-groups-daily',
  '0 2 * * *', -- ูู ููู ุงูุณุงุนุฉ 2 ุตุจุงุญุงู
  $$
  SELECT net.http_post(
    url:='https://nzuppbjtxmfrgutyagev.supabase.co/functions/v1/archive-expired-groups',
    headers:='{"Content-Type": "application/json", "Authorization": "Bearer YOUR_SERVICE_ROLE_KEY"}'::jsonb,
    body:='{}'::jsonb
  ) as request_id;
  $$
);
```

**ููุงุญุธุฉ**: ูุฌุจ ุงุณุชุจุฏุงู `YOUR_SERVICE_ROLE_KEY` ุจููุชุงุญ ุงูุฎุฏูุฉ ุงููุนูู ูู ุฅุนุฏุงุฏุงุช ุงููุดุฑูุน.

### 2. ุชุญุณููุงุช ูุญุชููุฉ

#### ุฃ. ุฅุดุนุงุฑุงุช ููุฃุนุถุงุก
- ุฅุดุนุงุฑ ูุจู 7 ุฃูุงู ูู ุฃุฑุดูุฉ ุงููุฌููุนุฉ
- ุฅุดุนุงุฑ ุนูุฏ ุงูุฃุฑุดูุฉ
- ุฅุดุนุงุฑ ูุจู ุงูุญุฐู ุงูููุงุฆู

#### ุจ. ุฅุญุตุงุฆูุงุช ูู ููุญุฉ ุงูุฃุฏูู
- ุนุฏุฏ ุงููุฌููุนุงุช ุงููุดุทุฉ/ุงููุคุฑุดูุฉ
- ุชูุฒูุน ุงููุฌููุนุงุช ุนูู ุงูุฃุฏููุฒ
- ูุชูุณุท ุนุฏุฏ ุงูุฃุนุถุงุก ููู ูุฌููุนุฉ

#### ุฌ. ุชุญุณููุงุช UX
- ุฅููุงููุฉ ุฅูุบุงุก ุงูุฃุฑุดูุฉ (ุงุณุชุนุงุฏุฉ ุงููุฌููุนุฉ)
- ุชุตุฏูุฑ ุจูุงูุงุช ุงููุฌููุนุฉ ูุจู ุงูุญุฐู
- ุณุฌู ูุดุงุทุงุช ุงููุฌููุนุฉ

### 3. ุงุฎุชุจุงุฑุงุช ูุทููุจุฉ

- โ ุงุฎุชุจุงุฑ ุฅูุดุงุก ูุฌููุนุฉ ุฌุฏูุฏุฉ
- โณ ุงุฎุชุจุงุฑ ุชุนููู ุงููุดุฑููู ุงูุชููุงุฆู
- โณ ุงุฎุชุจุงุฑ Load Balancing ููุฃุฏููุฒ
- โณ ุงุฎุชุจุงุฑ ุงูุฃุฑุดูุฉ ุงูุชููุงุฆูุฉ
- โณ ุงุฎุชุจุงุฑ ุงูุญุฐู ุงูุชููุงุฆู
- โณ ุงุฎุชุจุงุฑ ุฅุฏุงุฑุฉ ุงูุฃุนุถุงุก ูู ููุญุฉ ุงูุฃุฏูู

## ๐ ุชุญุฐูุฑุงุช ุฃูููุฉ

ุชู ุฑุตุฏ 6 ุชุญุฐูุฑุงุช ุฃูููุฉ ูู Supabase Linter (ูุนุธููุง ููุฌูุฏุฉ ูุณุจูุงู):
1. Security Definer View - ERROR
2. Function Search Path Mutable - WARN (ูุธููุชูู)
3. Auth OTP long expiry - WARN
4. Leaked Password Protection Disabled - WARN
5. Current Postgres version has security patches - WARN

**ุงูุชูุตูุฉ**: ูููุถู ูุนุงูุฌุฉ ุงูุชุญุฐูุฑุงุช ุงูุฃูููุฉ ูุถูุงู ุฃูุงู ุงููุธุงู.

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. **ุฅุนุฏุงุฏ Cron Job** (ูุฏูู - ุงูุธุฑ ุงูุฎุทูุงุช ุฃุนูุงู)
2. **ุงุฎุชุจุงุฑ ุงููุธุงู ุจุงููุงูู**:
   - ุฅูุดุงุก ูุฌููุนุฉ ูุนุงููุฉ
   - ุงูุชุญูู ูู ุชุนููู ุงููุดุฑููู
   - ุงุฎุชุจุงุฑ ุงูุชูุงุก ุงูุตูุงุญูุฉ
3. **ุฅุถุงูุฉ ุงูุฅุดุนุงุฑุงุช** (ุงุฎุชูุงุฑู)
4. **ูุนุงูุฌุฉ ุงูุชุญุฐูุฑุงุช ุงูุฃูููุฉ** (ููุตู ุจู)

## ๐ ููุงุญุธุงุช

- ุงููุธุงู ูุนูู ุจุดูู ูุงูู ุจุงุณุชุซูุงุก Cron Job ุงูุฐู ูุญุชุงุฌ ุฅุนุฏุงุฏ ูุฏูู
- ุฌููุน ุงูู Triggers ุชุนูู ุชููุงุฆูุงู
- Edge Function ุฌุงูุฒุฉ ูููุดูุฑุฉ
- ูุงุฌูุฉ ุงูุฃุฏูู ููุชููุฉ ูุชุนูู

---

**ุขุฎุฑ ุชุญุฏูุซ**: 2025-10-04
